---
phase: 01-foundation-compliance
plan: 03
type: execute
wave: 3
depends_on:
  - 01-02
files_modified:
  - src/pages/Dashboard.tsx
  - src/pages/Properties.tsx
  - src/components/property/PropertyCard.tsx
  - src/components/property/PropertyGrid.tsx
  - src/components/property/PropertyFilters.tsx
  - src/components/property/StatusBadge.tsx
  - src/components/property/PropertyPlaceholder.tsx
  - src/hooks/useDashboardMetrics.ts
  - src/hooks/useAI.ts
  - src/lib/claude.ts
  - src/components/property/AIDescriptionGenerator.tsx
  - src/components/layout/Header.tsx
  - src/components/layout/Sidebar.tsx
  - src/components/layout/DashboardLayout.tsx
autonomous: false
requirements:
  - ALTI-05
  - AIUI-07
user_setup:
  - service: anthropic
    why: "AI property description generation"
    env_vars:
      - name: VITE_CLAUDE_API_KEY
        source: "Anthropic Console -> API Keys -> Create Key"
    dashboard_config:
      - task: "Create Anthropic account and generate API key"
        location: "https://console.anthropic.com"

must_haves:
  truths:
    - "User sees dashboard with property counts by status"
    - "User sees property cards in 2-3 column grid layout"
    - "Property cards show photo/placeholder, price, location, m², rooms, status badge, date"
    - "User can filter properties by status, price range, location"
    - "Clicking property card opens detail page"
    - "User can generate AI description with 2-3 variants"
    - "User can select preferred AI description variant"
  artifacts:
    - path: "src/pages/Dashboard.tsx"
      provides: "Dashboard with metrics and property grid"
      min_lines: 80
    - path: "src/components/property/PropertyCard.tsx"
      provides: "Property card component per user design"
      min_lines: 50
    - path: "src/components/property/PropertyFilters.tsx"
      provides: "Filter controls for properties"
      min_lines: 40
    - path: "src/hooks/useAI.ts"
      provides: "Claude API integration for descriptions"
      exports: ["useAI"]
    - path: "src/lib/claude.ts"
      provides: "Claude API client with prompt caching"
      exports: ["generatePropertyDescription"]
  key_links:
    - from: "src/pages/Dashboard.tsx"
      to: "useDashboardMetrics"
      via: "hook call for counts"
      pattern: "useDashboardMetrics"
    - from: "src/components/property/PropertyCard.tsx"
      to: "react-router-dom"
      via: "Link to property detail"
      pattern: "Link.*properties"
    - from: "src/lib/claude.ts"
      to: "anthropic-ai/sdk"
      via: "client.messages.create with cache_control"
      pattern: "cache_control.*ephemeral"
---

<objective>
Build dashboard with property metrics, property card grid with filtering, and AI description generation.

Purpose: Dashboard is the main entry point showing portfolio overview. Property cards per user specifications enable quick browsing. AI description generation is the first AI feature demonstrating core value.

Output: Working dashboard with stats, property grid with cards and filters, AI description generator producing 2-3 professional Turkish variants.
</objective>

<execution_context>
@/home/cagr/.claude/get-shit-done/workflows/execute-plan.md
@/home/cagr/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-compliance/01-RESEARCH.md
@.planning/phases/01-foundation-compliance/01-CONTEXT.md
@.planning/phases/01-foundation-compliance/01-01-SUMMARY.md
@.planning/phases/01-foundation-compliance/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Dashboard Layout and Property Grid</name>
  <files>
    src/components/layout/Header.tsx
    src/components/layout/Sidebar.tsx
    src/components/layout/DashboardLayout.tsx
    src/pages/Dashboard.tsx
    src/pages/Properties.tsx
    src/components/property/PropertyCard.tsx
    src/components/property/PropertyGrid.tsx
    src/components/property/StatusBadge.tsx
    src/components/property/PropertyPlaceholder.tsx
    src/hooks/useDashboardMetrics.ts
    public/placeholders/daire.svg
    public/placeholders/villa.svg
    public/placeholders/arsa.svg
    public/placeholders/isyeri.svg
  </files>
  <action>
Create src/components/layout/Header.tsx:
- App title/logo on left
- User menu on right (dropdown with: Settings, Çıkış Yap)
- Responsive: hamburger menu on mobile

Create src/components/layout/Sidebar.tsx:
- Navigation links: Dashboard, Mülkler, Yeni Mülk Ekle, Ayarlar
- Active state highlighting
- Collapsible on mobile

Create src/components/layout/DashboardLayout.tsx:
- Wrap protected pages with consistent layout
- Header + Sidebar + main content area
- Responsive: sidebar becomes drawer on mobile

Create src/hooks/useDashboardMetrics.ts:
- Fetch property counts using getCountFromServer (per user decision: no trends)
- Return: { total, aktif, satildi, kiralik, opsiyonlu, loading }
- Use Firestore aggregate queries for efficiency

Create src/pages/Dashboard.tsx (per user decision: stats without trends):
- Page title: "Dashboard"
- Stats cards row: Toplam Mülk, Aktif, Satıldı, Kiralık
- Each stat card shows count with icon
- Simple number display (no trends per user decision)
- "Son Eklenen Mülkler" section showing last 6 properties
- "Tümünü Gör" link to /properties

Create src/components/property/StatusBadge.tsx (per user decision: intuitive colors):
- Badge component for property status
- Colors: aktif=green, satıldı=red, kiralık=blue, opsiyonlu=yellow
- Rounded badge style for card corner placement

Create src/components/property/PropertyPlaceholder.tsx (per user decision: type-specific):
- SVG placeholders for each property type
- Different visuals: daire (apartment building), villa (house with garden), arsa (land plot), işyeri (office)
- Create actual SVG files in public/placeholders/

Create src/components/property/PropertyCard.tsx (per user decision - detailed):
- Card layout per user specs:
  - Top: Image (or type-specific placeholder) with status badge in top-right corner
  - Photo container: fixed height, object-cover
  - Content: title, price (large, blue, formatted "1.500.000 ₺"), location icon + city/district, area + rooms, date added
- Entire card clickable (Link to /properties/:id)
- No hover menu per user decision (click only)
- Hover effect: subtle shadow increase
- Modern, clean design

Create src/components/property/PropertyGrid.tsx:
- Grid container: 1 col mobile, 2 cols tablet, 3 cols desktop (per user decision)
- gap-6 spacing
- Map over properties to render PropertyCard
- Empty state: "Henüz mülk eklemediniz" with CTA button

Create src/pages/Properties.tsx:
- Page title: "Mülkler"
- Filters component at top
- PropertyGrid below
- "Yeni Mülk Ekle" button in header
- Loading skeleton while fetching
  </action>
  <verify>
1. Navigate to /dashboard - see stats cards with counts
2. See "Son Eklenen Mülkler" section with property cards
3. Navigate to /properties - see full property grid
4. Verify card layout matches specs: image, badge, price, location, details
5. Verify responsive: 1 col on mobile, 2-3 on larger screens
6. Click card - navigates to property detail
7. Status badge shows correct colors
  </verify>
  <done>
Dashboard displays property metrics (total, aktif, satıldı, kiralık). Property cards render with all required fields per user decision. Grid is responsive (1-2-3 columns). Status badges use intuitive colors. Placeholders show for properties without images.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement Property Filters</name>
  <files>
    src/components/property/PropertyFilters.tsx
    src/pages/Properties.tsx
    src/hooks/useProperties.ts
    src/lib/constants.ts
  </files>
  <action>
Create src/lib/constants.ts:
- TURKISH_CITIES: array of top 30 Turkish cities for filter dropdown
- PROPERTY_TYPES: array of property type options with labels
- PROPERTY_FEATURES: array of common features (asansör, otopark, etc.)
- PRICE_RANGES: predefined ranges for filter (0-500K, 500K-1M, 1M-2M, 2M-5M, 5M-10M, 10M+)

Create src/components/property/PropertyFilters.tsx (per user decision: advanced filtering):
- Filter row with: Status dropdown, Price range (min-max or predefined), Location (city dropdown)
- "Filtrele" button to apply
- "Temizle" button to reset filters
- Collapsible on mobile (show/hide filters button)
- Filters stored in URL params for shareable links
- Design: horizontal on desktop, stacked on mobile

Update src/hooks/useProperties.ts:
- Accept filter parameters: { status?, type?, listingType?, city?, minPrice?, maxPrice? }
- Build Firestore query with where clauses for each active filter
- Handle compound queries properly (may need composite indexes)
- Note: Firestore limits compound queries - prioritize status + city as most common combo

Update src/pages/Properties.tsx:
- State for active filters
- Pass filters to useProperties hook
- Update URL params when filters change
- Parse URL params on mount to restore filters
- Show active filter count badge on mobile filter toggle
  </action>
  <verify>
1. Navigate to /properties - see filter controls
2. Select status filter - list updates to show only matching properties
3. Select price range - list filters correctly
4. Select city - list filters correctly
5. Combine multiple filters - all work together
6. Click "Temizle" - all filters reset
7. URL updates with filter params - reload page, filters persist
  </verify>
  <done>
Filters for status, price range, and city work together. Filters persist in URL. Filter combinations narrow down property list. Clear button resets all filters.
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement AI Description Generation</name>
  <files>
    src/lib/claude.ts
    src/hooks/useAI.ts
    src/components/property/AIDescriptionGenerator.tsx
    src/pages/PropertyDetail.tsx
    .env.example
  </files>
  <action>
Update .env.example:
- Add VITE_CLAUDE_API_KEY placeholder

Create src/lib/claude.ts:
- Initialize Anthropic client with API key from env
- Define SYSTEM_PROMPT for property descriptions in Turkish:
  ```
  Sen profesyonel bir emlak danışmanısın. Mülk özelliklerinden Türkçe ilan metni yazıyorsun.

  # Talimatlar
  - Ton: Profesyonel, kurumsal dil (per user decision)
  - Uzunluk: 100-200 kelime (per user decision)
  - Vurgu: Konum avantajları ve mülk özellikleri dengeli (per user decision)
  - Format: Akıcı paragraflar, abartısız ama çekici
  - Hedef: Emlak portallarına uygun ilan metni
  ```
- generatePropertyDescription(property: Property): Promise<string[]>
  - Use claude-sonnet-4-6 model
  - Apply cache_control: { type: 'ephemeral' } to system prompt (per research: 90% cost savings)
  - Request 3 variants separated by "---"
  - Parse response into array of variants
  - Handle errors gracefully with Turkish error messages

Create src/hooks/useAI.ts:
- generateDescriptions(property: Property): Promise<string[]>
- Return: { variants: string[], generating: boolean, error: string | null, generate: () => void }
- Track loading state during API call
- Cache results by property ID to avoid regenerating

Create src/components/property/AIDescriptionGenerator.tsx (per user decision: 2-3 variants, user selects):
- "AI ile İlan Metni Oluştur" button
- Loading state: spinner with "Oluşturuluyor..."
- Results view:
  - Show 3 variant cards side by side (or stacked on mobile)
  - Each variant in a card with:
    - "Varyant 1/2/3" label
    - Description text
    - "Bu Metni Kullan" button
  - "Yeniden Oluştur" button to regenerate
- On select: save selected variant to property.aiDescription field
- Success toast: "İlan metni kaydedildi"

Update src/pages/PropertyDetail.tsx:
- Add "İlan Metni" section
- If aiDescription exists, show it with "AI ile Yeniden Oluştur" button
- If no aiDescription, show AIDescriptionGenerator component
- "Düzenle" button to manually edit AI-generated text
  </action>
  <verify>
1. Navigate to property detail page
2. Click "AI ile İlan Metni Oluştur" - loading shown
3. See 3 variant descriptions appear
4. Variants are professional Turkish text, 100-200 words each
5. Click "Bu Metni Kullan" on one variant - saved to property
6. Refresh page - see saved description
7. Click "Yeniden Oluştur" - generates new variants
8. Check console for cache_control usage
  </verify>
  <done>
Claude API generates 3 professional Turkish property description variants. User can select preferred variant. Selected variant saved to Firestore. Prompt caching reduces API costs. Loading and error states handled properly.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 4: Verify Complete Phase 1 Flow</name>
  <what-built>
Complete Phase 1 Foundation: Authentication with email/password and Google OAuth, KVKK consent flow, property CRUD operations, dashboard with metrics, property cards with filtering, and AI description generation.
  </what-built>
  <how-to-verify>
1. **Fresh User Registration Flow:**
   - Visit http://localhost:5173/register
   - Fill form: email, password, name, phone, company
   - Submit - should see "Doğrulama e-postası gönderildi"
   - Check email for verification link (or use Firebase emulator)
   - After verification, should be redirected to KVKK consent page
   - Scroll KVKK text to bottom - button should enable
   - Accept - should reach dashboard

2. **Dashboard Verification:**
   - Dashboard shows stat cards: Toplam Mülk, Aktif, Satıldı, Kiralık
   - All counts should be 0 for new user

3. **Add Property:**
   - Click "Yeni Mülk Ekle"
   - Fill property form with test data
   - Submit - should redirect to property list
   - Verify card shows: image placeholder, price, location, status badge

4. **Property Filters:**
   - Add 2-3 more properties with different statuses/cities
   - Use status filter - list updates
   - Use price filter - list updates
   - Use city filter - list updates
   - Click "Temizle" - all properties shown

5. **AI Description:**
   - Open a property detail page
   - Click "AI ile İlan Metni Oluştur"
   - Wait for generation (may take 5-10 seconds)
   - See 3 Turkish description variants
   - Select one - should save to property
   - Refresh page - saved description visible

6. **Mobile Responsiveness:**
   - Resize browser to mobile width
   - Verify: cards stack to single column, sidebar collapses, filters collapsible

**Expected Issues:**
- If Claude API key not set, AI generation will fail - need user to provide key
- If Firebase not configured, auth will fail - need user to create Firebase project
  </how-to-verify>
  <resume-signal>Type "approved" if all flows work correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Dashboard loads with correct property counts
2. Property cards display all required fields per user specs
3. Card grid is responsive (1-2-3 columns based on screen)
4. Status badges use correct colors (green/red/blue/yellow)
5. Filters work individually and combined
6. Filter state persists in URL
7. AI generates 3 professional Turkish description variants
8. Selected AI description saves to property
9. Complete user flow works: register -> verify -> KVKK -> dashboard -> add property -> generate description
</verification>

<success_criteria>
- Dashboard shows property metrics (total, aktif, satıldı, kiralık)
- Property cards match user specification (photo, price, location, rooms, m², status, date)
- 2-3 column responsive grid layout
- Filters for status + price + city work together
- AI generates 100-200 word professional Turkish descriptions
- User can select from 2-3 AI variants
- Complete Phase 1 user journey verified
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-compliance/01-03-SUMMARY.md`
</output>
